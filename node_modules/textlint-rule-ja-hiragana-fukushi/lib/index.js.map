{"version":3,"sources":["../src/index.js"],"names":["fs","require","kuromojin","createMatcher","yaml","data","safeLoad","readFileSync","__dirname","dictionaries","dict","forEach","item","form","tokens","token","surface_form","push","message","expected","fix","matchAll","reporter","context","options","Syntax","RuleError","report","getSource","fixer","Str","node","text","then","actualTokens","results","length","result","tokenIndex","index","getIndexFromTokens","replaceFrom","replaceTo","replaceTextRange","ruleError","i","module","exports","linter"],"mappings":"AAAA;;;;AAEA,IAAMA,KAAKC,QAAQ,IAAR,CAAX;AACA,IAAMC,YAAYD,QAAQ,WAAR,CAAlB;AACA,IAAME,gBAAgBF,QAAQ,oBAAR,CAAtB;AACA,IAAMG,OAAOH,QAAQ,SAAR,CAAb;AACA,IAAMI,OAAOD,KAAKE,QAAL,CAAcN,GAAGO,YAAH,CAAgBC,YAAY,sBAA5B,EAAoD,MAApD,CAAd,CAAb;;AAEA,IAAMC,eAAe,EAArB;;AAEAJ,KAAKK,IAAL,CAAUC,OAAV,CAAkB,UAAUC,IAAV,EAAgB;AAChC,MAAIC,OAAO,EAAX;AACAD,OAAKE,MAAL,CAAYH,OAAZ,CAAoB,UAAUI,KAAV,EAAiB;AACnCF,YAAQE,MAAMC,YAAd;AACD,GAFD;AAGAP,eAAaQ,IAAb,CAAkB;AAChBC,aAASb,KAAKa,OAAL,GAAe,MAAf,GAAwBL,IAAxB,GAA+B,UAA/B,GAA4CD,KAAKO,QAAjD,GAA4D,IADrD;AAEhBC,SAAKR,KAAKO,QAFM;AAGhBL,YAAQF,KAAKE;AAHG,GAAlB;AAKD,CAVD;;AAYA,IAAMO,WAAWlB,cAAcM,YAAd,CAAjB;;AAEA,SAASa,QAAT,CAAkBC,OAAlB,EAAyC;AAAA,MAAdC,OAAc,uEAAJ,EAAI;AAAA,MAChCC,MADgC,GACeF,OADf,CAChCE,MADgC;AAAA,MACxBC,SADwB,GACeH,OADf,CACxBG,SADwB;AAAA,MACbC,MADa,GACeJ,OADf,CACbI,MADa;AAAA,MACLC,SADK,GACeL,OADf,CACLK,SADK;AAAA,MACMC,KADN,GACeN,OADf,CACMM,KADN;;AAEvC,6BACGJ,OAAOK,GADV,YACeC,IADf,EACoB;AAAE;AAClB,QAAMC,OAAOJ,UAAUG,IAAV,CAAb,CADgB,CACc;AAC9B,WAAO7B,UAAU8B,IAAV,EAAgBC,IAAhB,CAAqB,UAACC,YAAD,EAAkB;AAC5C,UAAMC,UAAUd,SAASa,YAAT,CAAhB;;AAEA,UAAIC,QAAQC,MAAR,IAAkB,CAAtB,EAAyB;AACvB;AACD;;AAEDD,cAAQxB,OAAR,CAAgB,UAAU0B,MAAV,EAAkB;AAChC,YAAMC,aAAaD,OAAOE,KAA1B;AACA,YAAMA,QAAQC,mBAAmBF,UAAnB,EAA+BJ,YAA/B,CAAd;AACA,YAAIO,cAAc,EAAlB;AACAJ,eAAOvB,MAAP,CAAcH,OAAd,CAAsB,UAASI,KAAT,EAAe;AACnC0B,yBAAe1B,MAAMC,YAArB;AACD,SAFD;AAGA,YAAM0B,YAAYb,MAAMc,gBAAN,CAAuB,CAACJ,KAAD,EAAQA,QAAQE,YAAYL,MAA5B,CAAvB,EAA4DC,OAAO3B,IAAP,CAAYU,GAAxE,CAAlB;AACA,YAAMwB,YAAY,IAAIlB,SAAJ,CAAcW,OAAO3B,IAAP,CAAYQ,OAA1B,EAAmC;AACnDqB,iBAAOA,KAD4C;AAEnDnB,eAAOsB,SAF4C,CAElC;AAFkC,SAAnC,CAAlB;AAIAf,eAAOI,IAAP,EAAaa,SAAb;AACD,OAbD;AAcD,KArBM,CAAP;AAsBD,GAzBH;AA2BD;;AAED,SAASJ,kBAAT,CAA4BF,UAA5B,EAAwCJ,YAAxC,EAAsD;AACpD,MAAIK,QAAQ,CAAZ;AACA,OAAM,IAAIM,IAAI,CAAd,EAAiBA,IAAIP,UAArB,EAAiCO,GAAjC,EAAsC;AACpCN,aAASL,aAAaW,CAAb,EAAgB7B,YAAhB,CAA6BoB,MAAtC;AACD;AACD,SAAOG,KAAP;AACD;;AAEDO,OAAOC,OAAP,GAAiB;AACfC,UAAQ1B,QADO;AAEfO,SAAOP;AAFQ,CAAjB","file":"index.js","sourcesContent":["\"use strict\";\n\nconst fs = require(\"fs\");\nconst kuromojin = require(\"kuromojin\");\nconst createMatcher = require(\"morpheme-match-all\");\nconst yaml = require(\"js-yaml\");\nconst data = yaml.safeLoad(fs.readFileSync(__dirname + \"/../dict/fukushi.yml\", \"utf8\"));\n\nconst dictionaries = [];\n\ndata.dict.forEach(function (item) {\n  var form = \"\";\n  item.tokens.forEach(function (token) {\n    form += token.surface_form;\n  });\n  dictionaries.push({\n    message: data.message + \": \\\"\" + form + \"\\\" => \\\"\" + item.expected + \"\\\"\",\n    fix: item.expected,\n    tokens: item.tokens\n  });\n});\n\nconst matchAll = createMatcher(dictionaries);\n\nfunction reporter(context, options = {}) {\n  const {Syntax, RuleError, report, getSource, fixer} = context;\n  return {\n    [Syntax.Str](node){ // \"Str\" node\n      const text = getSource(node); // Get text\n      return kuromojin(text).then((actualTokens) => {\n        const results = matchAll(actualTokens);\n\n        if (results.length == 0) {\n          return;\n        }\n\n        results.forEach(function (result) {\n          const tokenIndex = result.index;\n          const index = getIndexFromTokens(tokenIndex, actualTokens);\n          let replaceFrom = \"\";\n          result.tokens.forEach(function(token){\n            replaceFrom += token.surface_form;\n          });\n          const replaceTo = fixer.replaceTextRange([index, index + replaceFrom.length], result.dict.fix);\n          const ruleError = new RuleError(result.dict.message, {\n            index: index,\n            fix:   replaceTo // https://github.com/textlint/textlint/blob/master/docs/rule-fixable.md\n          });\n          report(node, ruleError);\n        });\n      });\n    }\n  };\n}\n\nfunction getIndexFromTokens(tokenIndex, actualTokens) {\n  let index = 0;\n  for ( let i = 0; i < tokenIndex; i++) {\n    index += actualTokens[i].surface_form.length;\n  }\n  return index;\n}\n\nmodule.exports = {\n  linter: reporter,\n  fixer: reporter\n};\n\n"]}